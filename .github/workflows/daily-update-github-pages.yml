name: Daily Update GitHub Pages

on:
  schedule:
    - cron: "0 4 * * 2"   # Mondays 23:00 CT (CDT -> UTC 04:00 Tue)
    - cron: "0 4 * * 5"   # Thursdays 23:00 CT (CDT -> UTC 04:00 Fri)
    - cron: "30 16 * * 0" # Sundays 11:30 CT (CDT -> UTC 19:30 Sun)
    - cron: "30 19 * * 0" # Sundays 14:30 CT (CDT -> UTC 19:30 Sun)
    - cron: "0 23 * * 0"  # Sundays 18:00 CT (CDT -> UTC 23:00 Sun)
    - cron: "0 3 * * 1"   # Sundays 22:00 CT (CDT -> UTC 03:00 Mon)
  workflow_dispatch:     # Allows manual trigger

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
    
        steps: 
        -   name: Checkout Repository to start
            uses: actions/checkout@v4

        -   name: Setup Node.js
            uses: actions/setup-node@v4
            with:
                node-version: '18'

        -   name: Install Dependencies
            run: npm install

        -   name: Run football bot to create data.json
            run: |
                node -e "require('./src/football-bot').GetStandingsStringifyed().then(d=>console.log(d)).catch(err=>{ console.error(err); process.exit(1); })" > site/public/data.json
        
        -   name: Install Site Dependencies
            working-directory: site
            run: npm install
        
        -   name: Build React App
            working-directory: site
            run: npm run build

        -   name: Setup Pages
            uses: actions/configure-pages@v5
        
        -   name: Upload artifact
            uses: actions/upload-pages-artifact@v3
            with:
              path: ./site/dist
        
        -   name: Deploy to GitHub Pages
            id: deployment
            uses: actions/deploy-pages@v4
