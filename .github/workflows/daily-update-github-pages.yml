name: Daily Update GitHub Pages

on:
  schedule:
    - cron: '0 0 * * *' # Runs daily at midnight UTC
  workflow_dispatch:     # Allows manual trigger


jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
    
        steps: 
        -   name: Checkout Repository to start
            uses: actions/checkout@v4

        -   name: Setup Node.js
            uses: actions/setup-node@v4
            with:
                node-version: '18'

        -   name: Install Dependencies
            run: npm install

        -   name: Run football bot to create data.json
            run: |
                node -e "require('./src/football-bot').getStandingsData().then(d=>console.log(d)).catch(err=>{ console.error(err); process.exit(1); })" > site/public/data.json

        -   name: Build React App
            working-directory: site
            run: npm run build

        -   name: Deploy to GitHub Pages
            uses: peaceiris/actions-gh-pages@v3
            with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
                publish_dir: ./site/dist
